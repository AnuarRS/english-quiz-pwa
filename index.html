<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EnglishBoost - Полное обучение</title>
    <meta name="theme-color" content="#58cc02">
    <style>
        /* ... (предыдущие стили остаются без изменений) ... */

        /* Обновленные стили для змейки */
        .snake-container {
            display: none;
            margin-bottom: 30px;
        }

        .question-container.snake-mode .snake-container {
            display: block;
        }

        .question-container.snake-mode .options-grid,
        .question-container.snake-mode .game-area,
        .question-container.snake-mode .input-container,
        .question-container.snake-mode .voice-container,
        .question-container.snake-mode .puzzle-container {
            display: none;
        }

        .snake-game-area {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 400px;
            margin: 0 auto;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            border-radius: 15px;
            border: 3px solid #dfe4ea;
            overflow: hidden;
        }

        .snake-segment {
            position: absolute;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            border-radius: 4px;
            transition: all 0.1s linear;
            z-index: 2;
        }

        .snake-head {
            background: linear-gradient(135deg, #0984e3 0%, #6c5ce7 100%);
            box-shadow: 0 2px 8px rgba(9, 132, 227, 0.6);
            z-index: 3;
        }

        .letter-food {
            position: absolute;
            width: 25px;
            height: 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1em;
            box-shadow: 0 3px 8px rgba(102, 126, 234, 0.4);
            z-index: 1;
            transition: all 0.3s ease;
        }

        .letter-food.target {
            background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
            animation: pulse 1s infinite;
            transform: scale(1.2);
            z-index: 4;
        }

        .snake-word-display {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e8e8e8;
        }

        .snake-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 20px auto;
            width: 180px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .snake-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 3px 6px rgba(102, 126, 234, 0.3);
            user-select: none;
        }

        .snake-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.5);
        }

        .snake-btn:active {
            transform: scale(0.95);
        }

        .snake-btn.up { grid-column: 2; grid-row: 1; }
        .snake-btn.left { grid-column: 1; grid-row: 2; }
        .snake-btn.right { grid-column: 3; grid-row: 2; }
        .snake-btn.down { grid-column: 2; grid-row: 3; }

        .snake-hint {
            text-align: center;
            color: #636e72;
            font-size: 0.9em;
            margin-top: 10px;
            padding: 0 20px;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1.2); }
            50% { transform: scale(1.4); }
        }

        /* ... (остальные стили остаются без изменений) ... */
    </style>
</head>
<body>
    <div class="quiz-container">
        <!-- ... (остальная разметка без изменений) ... -->

        <div class="main-content">
            <!-- ... (остальная разметка без изменений) ... -->

            <div class="question-container" id="questionScreen">
                <!-- ... (остальная разметка без изменений) ... -->

                <div class="snake-container">
                    <div class="snake-word-display" id="snakeWordDisplay">Collected: </div>
                    <div class="snake-game-area" id="snakeGameArea"></div>
                    <div class="snake-controls">
                        <button class="snake-btn up" onclick="changeSnakeDirection('up')">↑</button>
                        <button class="snake-btn left" onclick="changeSnakeDirection('left')">←</button>
                        <button class="snake-btn right" onclick="changeSnakeDirection('right')">→</button>
                        <button class="snake-btn down" onclick="changeSnakeDirection('down')">↓</button>
                    </div>
                    <div class="snake-hint">Соберите буквы в правильном порядке. Используйте стрелки для управления змейкой</div>
                </div>
                
                <div class="feedback" id="feedback"></div>
            </div>

            <!-- ... (остальная разметка без изменений) ... -->
        </div>
    </div>

    <script>
        // ... (предыдущие переменные и функции остаются без изменений) ...

        // Обновленные функции для змейки
        function initSnakeGame(word) {
            console.log("Инициализация змейки для слова:", word);
            snakeTargetWord = word.toUpperCase();
            collectedLetters = '';
            snakeDirection = 'right';
            
            // Инициализация змейки в центре с безопасным расстоянием
            const centerX = 200;
            const centerY = 200;
            snake = [
                { x: centerX, y: centerY },
                { x: centerX - 20, y: centerY },
                { x: centerX - 40, y: centerY }
            ];

            // Размещение букв случайным образом с безопасным расстоянием от змейки
            letterPositions = [];
            const letters = snakeTargetWord.split('');
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            
            // Добавляем буквы целевого слова
            letters.forEach((letter, index) => {
                let pos = getRandomSafePosition();
                letterPositions.push({ letter, x: pos.x, y: pos.y, isTarget: true, index });
            });

            // Уменьшаем количество случайных букв в 2 раза (было 10, стало 5)
            for (let i = 0; i < 5; i++) {
                const randomLetter = alphabet[Math.floor(Math.random() * alphabet.length)];
                let pos = getRandomSafePosition();
                letterPositions.push({ letter: randomLetter, x: pos.x, y: pos.y, isTarget: false });
            }

            updateSnakeDisplay();
            renderSnakeGame();
            
            clearSnakeInterval();
            snakeInterval = setInterval(moveSnake, snakeSpeed);
        }

        function getRandomSafePosition() {
            const safeDistance = 80; // Минимальное расстояние от центра
            let attempts = 0;
            let pos;
            
            do {
                pos = {
                    x: Math.floor(Math.random() * 18) * 20 + 10,
                    y: Math.floor(Math.random() * 18) * 20 + 10
                };
                attempts++;
                
                // Проверяем расстояние от центра (200,200)
                const distanceFromCenter = Math.sqrt(
                    Math.pow(pos.x - 200, 2) + Math.pow(pos.y - 200, 2)
                );
                
                // Проверяем расстояние от змейки
                let tooCloseToSnake = snake.some(segment => 
                    Math.abs(segment.x - pos.x) < 40 && Math.abs(segment.y - pos.y) < 40
                );
                
                if (distanceFromCenter >= safeDistance && !tooCloseToSnake) {
                    return pos;
                }
                
            } while (attempts < 50); // Максимум 50 попыток
            
            // Если не нашли безопасную позицию, возвращаем любую
            return {
                x: Math.floor(Math.random() * 18) * 20 + 10,
                y: Math.floor(Math.random() * 18) * 20 + 10
            };
        }

        function renderSnakeGame() {
            const gameArea = document.getElementById('snakeGameArea');
            if (!gameArea) {
                console.error("Snake game area not found!");
                return;
            }
            gameArea.innerHTML = '';

            // Отрисовка змейки
            snake.forEach((segment, index) => {
                const segmentEl = document.createElement('div');
                segmentEl.className = 'snake-segment' + (index === 0 ? ' snake-head' : '');
                segmentEl.style.left = segment.x + 'px';
                segmentEl.style.top = segment.y + 'px';
                gameArea.appendChild(segmentEl);
            });

            // Отрисовка букв
            letterPositions.forEach((letterPos, index) => {
                const letterEl = document.createElement('div');
                letterEl.className = 'letter-food';
                
                // Подсвечиваем следующую целевую букву
                if (letterPos.isTarget && letterPos.index === collectedLetters.length) {
                    letterEl.classList.add('target');
                }
                
                letterEl.textContent = letterPos.letter;
                letterEl.style.left = (letterPos.x - 12.5) + 'px';
                letterEl.style.top = (letterPos.y - 12.5) + 'px';
                gameArea.appendChild(letterEl);
            });
        }

        function moveSnake() {
            if (answered) return;

            const head = { ...snake[0] };

            switch (snakeDirection) {
                case 'up': head.y -= 20; break;
                case 'down': head.y += 20; break;
                case 'left': head.x -= 20; break;
                case 'right': head.x += 20; break;
            }

            // Проверка столкновения со стенами
            if (head.x < 0 || head.x >= 400 || head.y < 0 || head.y >= 400) {
                gameOver();
                return;
            }

            // Проверка столкновения с собой
            if (snake.some((segment, index) => index > 0 && segment.x === head.x && segment.y === head.y)) {
                gameOver();
                return;
            }

            snake.unshift(head);

            // Проверка столкновения с буквой
            const collisionIndex = letterPositions.findIndex(letter => 
                Math.abs(letter.x - head.x) < 20 && Math.abs(letter.y - head.y) < 20
            );

            if (collisionIndex !== -1) {
                const collectedLetter = letterPositions[collisionIndex];
                
                // Проверяем, правильная ли это следующая буква
                if (collectedLetter.isTarget && collectedLetter.index === collectedLetters.length) {
                    collectedLetters += collectedLetter.letter;
                    letterPositions.splice(collisionIndex, 1);
                    updateSnakeDisplay();

                    // Проверяем, собрано ли все слово
                    if (collectedLetters === snakeTargetWord) {
                        processSnakeWin();
                        return;
                    }
                } else {
                    // Неправильная буква - конец игры
                    gameOver();
                    return;
                }
            } else {
                snake.pop();
            }

            renderSnakeGame();
        }

        function changeSnakeDirection(newDirection) {
            const opposites = { up: 'down', down: 'up', left: 'right', right: 'left' };
            if (snakeDirection !== opposites[newDirection] && snake.length > 1) {
                snakeDirection = newDirection;
            } else if (snake.length === 1) {
                // Разрешаем разворот если змейка состоит только из головы
                snakeDirection = newDirection;
            }
        }

        function updateSnakeDisplay() {
            const display = document.getElementById('snakeWordDisplay');
            if (display) {
                display.textContent = `Collected: ${collectedLetters} / ${snakeTargetWord}`;
            }
        }

        function clearSnakeInterval() {
            if (snakeInterval) {
                clearInterval(snakeInterval);
                snakeInterval = null;
            }
        }

        function gameOver() {
            clearSnakeInterval();
            const feedback = document.getElementById('feedback');
            if (feedback) {
                feedback.textContent = '❌ Игра окончена! Неправильная буква или столкновение.';
                feedback.classList.add('incorrect', 'show');
            }
            
            setTimeout(() => {
                initSnakeGame(snakeTargetWord);
                if (feedback) feedback.classList.remove('show');
            }, 2000);
        }

        function processSnakeWin() {
            clearSnakeInterval();
            answered = true;
            
            const question = shuffledQuestions[currentQuestion];
            score += 10;
            wordProgress[question.question]++;
            
            const feedback = document.getElementById('feedback');
            if (feedback) {
                feedback.textContent = `🎉 Отлично! Слово "${snakeTargetWord}" собрано!`;
                feedback.classList.add('correct', 'show');
            }
            
            updateUI();
            saveProgress();
            
            setTimeout(() => {
                currentQuestion++;
                displayQuestion();
            }, 2500);
        }

        // Управление змейкой с клавиатуры
        document.addEventListener('keydown', (e) => {
            if (!snakeInterval) return;
            
            switch(e.key) {
                case 'ArrowUp': 
                    e.preventDefault();
                    changeSnakeDirection('up'); 
                    break;
                case 'ArrowDown': 
                    e.preventDefault();
                    changeSnakeDirection('down'); 
                    break;
                case 'ArrowLeft': 
                    e.preventDefault();
                    changeSnakeDirection('left'); 
                    break;
                case 'ArrowRight': 
                    e.preventDefault();
                    changeSnakeDirection('right'); 
                    break;
            }
        });

        // ... (остальной код без изменений) ...
    </script>
</body>
</html>
